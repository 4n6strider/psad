#
###########################################################################
#
#  This is the configuration file for psad (the Port Scan Attack Detector).
#  Normally this file gets installed at /etc/psad/psad.conf, but can be put
#  anywhere in the filesystem and then the path can be specified on the
#  command line argument "-c <file>" to psad.  Psad.conf is read by all
#  four of the psad daemons; psad, psadwatchd, diskmond, and kmsgsd.  The
#  syntax of this file is as follows:
#
#  Each line has the form  "<variable name>    <value>;".  Note the semi-
#  colon after the <value>.  All characters after the semicolon will be
#  ignored to provide space for comments.
#
###########################################################################
#
# $Id$
#

### Supports multiple email addresses (as a comma separated
### list).
EMAIL_ADDRESSES             root@localhost;

### Machine hostname
HOSTNAME                    CHANGE_ME;

### Danger levels.  These represent the total number of
### packets required for a scan to reach each danger level.
### A scan may also reach a danger level if the scan trips
### a signature or if the scanning ip is listed in
### psad_auto_ips so a danger level is automatically
### assigned.
DANGER_LEVEL1               5;    ### Number of packets.
DANGER_LEVEL2               50;
DANGER_LEVEL3               1000;
DANGER_LEVEL4               5000;
DANGER_LEVEL5               10000;

### Set the interval (in seconds) psad will use to sleep before
### checking for new iptables log messages
PSAD_CHECK_INTERVAL         5;

### The following two variables can be modified to look for logging
### messages that are specific to your firewall configuration (specified
### by the "--log-prefix" for iptables firewalls).  For example, if your
### firewall uses the string "Audit" for packets that have been blocked,
### then you could set FW_MSG_SEARCH = "Audit";
FW_MSG_SEARCH               DROP;

### Search for snort "sid" values generated by fwsnort
### or snort2iptables
SNORT_SID_STR               SID;

### Set the minimum range of ports that must be scanned before
### psad will send an alert.  The default is 1 so that at
### least two port must be scanned (p2-p1 >= 1).  This can be set
### to 0 if you want psad to be extra paranoid, or 30000 if not.
PORT_RANGE_SCAN_THRESHOLD   1;

### If "Y", means that scans will never timeout.
ENABLE_PERSISTENCE          Y;

### This is used only if ENABLE_PERSISTENCE = "N";
SCAN_TIMEOUT                3600;  ### seconds

### If "Y", means all signatures will be shown since
### the scan started instead of just the current ones.
SHOW_ALL_SIGNATURES         N;

### XXX: try to mitigate the affects of the iptables connection
### tracking bug by ignoring tcp packets that have the ack bit set.
### Read the "BUGS" section of the psad man page.  Note that
### if a packet matches a snort SID (see SNORT_SID_STR variable)
### then psad will see it even if the ack bit is set.
IGNORE_CONNTRACK_BUG_PKTS   Y;

### Send email alert if danger level >= to this value.
EMAIL_ALERT_DANGER_LEVEL    1;

### Send no more than this number of emails for a single
### scanning source ip.
PSAD_EMAIL_LIMIT            50;

### If "Y", send email for all new bad packets instead
### of just when a danger level increases
ALERT_ALL                   Y;

### Send scan logs to dshield.org.  This is disabled by default,
### but is a good idea to enable it (subject to your site security
### policy) since the dshield service helps to track the bad guys.
### For more information visit http://www.dshield.org
ENABLE_DSHIELD_ALERTS       N;

### dshield.org alert email address; this should not be changed
### unless the guys at dshield have changed it.
DSHIELD_ALERT_EMAIL         reports@dshield.org;

### Time interval (hours) to send email alerts to dshield.org.
### The default is 6 hours, and cannot be less than 1 hour or
### more than 24 hours.
DSHIELD_ALERT_INTERVAL      6;

### If you have a dshield user id you can set it here.  The
### default is "0".
DSHIELD_USER_ID             0;

### If you want the outbound dshield email to appear as though it
### is coming from a particular user address then set it here.
DSHIELD_USER_EMAIL          NONE;

### Directories
PSAD_DIR                    /var/log/psad;
SCAN_DATA_ARCHIVE_DIR       /var/log/psad/scan_archive;
PSAD_ERROR_DIR              /var/log/psad/errs;
SNORT_RULES_DIR             /etc/psad/snort_rules;

### Files
FW_DATA_FILE                /var/log/psad/fwdata;
FW_CHECK_FILE               /var/log/psad/fw_check;
PSAD_PID_FILE               /var/run/psad/psad.pid;
PSAD_CMDLINE_FILE           /var/run/psad/psad.cmd;
PSAD_SIGS_FILE              /etc/psad/psad_signatures;
PSAD_AUTO_IPS_FILE          /etc/psad/psad_auto_ips;
PSAD_POSF_FILE              /etc/psad/psad_posf;
PSAD_LOG                    /var/log/psad/psad.log;
PSAD_FIFO                   /var/lib/psad/psadfifo;

### PID files
KMSGSD_PID_FILE             /var/run/psad/kmsgsd.pid;
DISKMOND_PID_FILE           /var/run/psad/diskmond.pid;
PSADWATCHD_PID_FILE         /var/run/psad/psadwatchd.pid;

### Packet counters for tcp, udp, and icmp protocols
PACKET_COUNTER_FILE         /var/log/psad/packet_ctr;

### If "Y", enable automated IDS response (auto manages
### firewall rulesets).
ENABLE_AUTO_IDS             N;

### List of ips that have been auto blocked by iptables, ipchains,
### or tcpwrappers (the auto blocking feature is disabled by
### default, see the psad man page and the ENABLE_AUTO_IDS
### variable).
AUTO_BLOCK_IPT_FILE         /var/log/psad/auto_blocked_iptables;
AUTO_BLOCK_IPCH_FILE        /var/log/psad/auto_blocked_ipchains;
AUTO_BLOCK_TCPWR_FILE       /var/log/psad/auto_blocked_tcpwr;

FW_ERROR_LOG                /var/log/psad/errs/fwerrorlog;
PRINT_SCAN_HASH             /var/log/psad/scan_hash;

### /proc interface for controlling ip forwarding
PROC_FORWARD_FILE           /proc/sys/net/ipv4/ip_forward;

### Enable iptables blocking (only gets enabled if
### ENABLE_AUTO_IDS is also set)
IPTABLES_BLOCK_METHOD       Y;

### Specify the position or rule number within the iptables
### policy where auto block rules get added.
IPTABLES_AUTO_RULENUM       1;

### Enable ipchains blocking (only gets enabled if
### ENABLE_AUTO_IDS is also set)
IPCHAINS_BLOCK_METHOD       N;

### Specify the position or rule number within the ipchains
### policy where auto block rules get added.
IPCHAINS_AUTO_RULENUM       1;

### Enable tcp wrappers blocking
TCPWRAPPERS_BLOCK_METHOD    N;

### Block all traffic from offending IP if danger
### level >= to this value
AUTO_IDS_DANGER_LEVEL       5;

### Set the auto-blocked timeout in seconds (the default
### is one hour).
AUTO_BLOCK_TIMEOUT          3600;

### Set the whois timeout
WHOIS_TIMEOUT               60;  ### seconds

### Set the number of times an ip can be seen before another whois
### lookup is issued.
WHOIS_THRESHOLD             20;

### Enable psad to run an external script or program
ENABLE_EXT_SCRIPT_EXEC      N;

### Define an external program to run after a scan is caught.
### Note that the scan source ip can be specified on the command
### line to the external program through the use of the "SRCIP"
### string (along with some appropriate switch for the program).
### Of course this is only useful if the external program knows
### what to do with this information.
### Example:  EXTERNAL_SCRIPT       /path/to/script --ip SRCIP -v;
EXTERNAL_SCRIPT             /bin/true;

### Control execution of EXTERNAL_SCRIPT (only once per ip, or
### every time a scan is detected for an ip).
EXEC_EXT_SCRIPT_PER_ALERT   N;

### system binaries
shCmd          /bin/sh;
#ipchainsCmd    /sbin/ipchains; ### uncoment if kernel < 2.4
iptablesCmd    /sbin/iptables;
mknodCmd       /bin/mknod;
psCmd          /bin/ps;
mailCmd        /bin/mail;
sendmailCmd    /usr/sbin/sendmail;
ifconfigCmd    /sbin/ifconfig;
syslogdCmd     /sbin/syslogd;
killallCmd     /usr/bin/killall;
netstatCmd     /bin/netstat;
unameCmd       /bin/uname;
whoisCmd       /usr/bin/whois_psad;
psadwatchdCmd  /usr/sbin/psadwatchd;
kmsgsdCmd      /usr/sbin/kmsgsd;
diskmondCmd    /usr/sbin/diskmond;
psadCmd        /usr/sbin/psad;
